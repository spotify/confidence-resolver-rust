syntax = "proto3";

package confidence.flags.resolver.v1;

option go_package = "github.com/spotify/confidence-resolver-rust/mock-support-server/genproto/mock;mockpb";

import "google/api/annotations.proto";
// import "google/protobuf/timestamp.proto";

// TODO this should be uncommented once all providers (Go?) stop using the flags_admin
// service ResolverStateService {

//   // Gets a signed uri that can be used to download the current resolver state
//   rpc ResolverStateUri(ResolverStateUriRequest) returns (ResolverStateUriResponse) {
//     option (google.api.http) = {
//       get: "/v1/resolverState:resolverStateUri"
//     };
//   }
// }

// // Request to fetch resolver state uri
// message ResolverStateUriRequest {}

// // Response of fetching resolver state uri
// message ResolverStateUriResponse {
//   // The signed uri that can be used to fetch state
//   string signed_uri = 1;
//   // At what time the state uri expires
//   google.protobuf.Timestamp expire_time = 2;
//   // The account the referenced state belongs to
//   string account = 3;
// }


service InternalFlagLoggerService {
  // Writes flag assignment events and resolve logs together.
  rpc WriteFlagLogs(WriteFlagLogsRequest) returns (WriteFlagLogsResponse){
    option (google.api.http) = {
      post: "/v1/flagLogs:write"
      body: "*"
    };
  }

}

// The service that allows to report flag assigned and other client-side flag
// operations, useful when the resolve engine runs on the customer's premises
// (e.g. side-car)
message WriteFlagLogsRequest {
  repeated bytes flag_assigned = 1;

  // TelemetryData telemetry_data = 2;

  repeated bytes client_resolve_info = 3;
  repeated bytes flag_resolve_info = 4;
}

message WriteFlagLogsResponse {}

